<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>20x performance boost with V8Js snapshots | stesie's musings</title>
<meta name=keywords content="V8Js,V8 Heap Snapshots,performance"><meta name=description content="Recently @virgofx filed an issue on V8Js whether (startup) performance of V8Js could be increased. He wants to do server-side React rendering and noticed that V8 itself needs roughly 50ms to initialize and then further 60ms to process React & ReactServer javascript code. Way too much for server side rendering (on more or less every request).
Up to V8 4.4 you simply could compile it with snapshots and V8Js made use of them."><meta name=author content="Stefan Siegl"><link rel=canonical href=https://stesie.github.io/2016/02/snapshot-performance/><link crossorigin=anonymous href=/assets/css/stylesheet.eaf1c0e3f8327b0eecb58a6cafac5ca1bc09ab794ba654be960d9aa6b1cdd1c7.css integrity="sha256-6vHA4/gyew7stYpsr6xcobwJq3lLplS+lg2aprHN0cc=" rel="preload stylesheet" as=style><link rel=icon href=https://stesie.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://stesie.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://stesie.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://stesie.github.io/apple-touch-icon.png><link rel=mask-icon href=https://stesie.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://stesie.github.io/2016/02/snapshot-performance/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="20x performance boost with V8Js snapshots"><meta property="og:description" content="Recently @virgofx filed an issue on V8Js whether (startup) performance of V8Js could be increased. He wants to do server-side React rendering and noticed that V8 itself needs roughly 50ms to initialize and then further 60ms to process React & ReactServer javascript code. Way too much for server side rendering (on more or less every request).
Up to V8 4.4 you simply could compile it with snapshots and V8Js made use of them."><meta property="og:type" content="article"><meta property="og:url" content="https://stesie.github.io/2016/02/snapshot-performance/"><meta property="article:section" content="pages"><meta property="article:published_time" content="2016-02-29T00:00:00+00:00"><meta property="article:modified_time" content="2025-01-03T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="20x performance boost with V8Js snapshots"><meta name=twitter:description content="Recently @virgofx filed an issue on V8Js whether (startup) performance of V8Js could be increased. He wants to do server-side React rendering and noticed that V8 itself needs roughly 50ms to initialize and then further 60ms to process React & ReactServer javascript code. Way too much for server side rendering (on more or less every request).
Up to V8 4.4 you simply could compile it with snapshots and V8Js made use of them."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Pages","item":"https://stesie.github.io/pages/"},{"@type":"ListItem","position":2,"name":"20x performance boost with V8Js snapshots","item":"https://stesie.github.io/2016/02/snapshot-performance/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"20x performance boost with V8Js snapshots","name":"20x performance boost with V8Js snapshots","description":"Recently @virgofx filed an issue on V8Js whether (startup) performance of V8Js could be increased. He wants to do server-side React rendering and noticed that V8 itself needs roughly 50ms to initialize and then further 60ms to process React \u0026amp; ReactServer javascript code. Way too much for server side rendering (on more or less every request).\nUp to V8 4.4 you simply could compile it with snapshots and V8Js made use of them.","keywords":["V8Js","V8 Heap Snapshots","performance"],"articleBody":"Recently @virgofx filed an issue on V8Js whether (startup) performance of V8Js could be increased. He wants to do server-side React rendering and noticed that V8 itself needs roughly 50ms to initialize and then further 60ms to process React \u0026 ReactServer javascript code. Way too much for server side rendering (on more or less every request).\nUp to V8 4.4 you simply could compile it with snapshots and V8Js made use of them. With 4.4 that stopped (V8Js just kept crashing), and I never really cared what they could do nor what the performance hit of this is, I just disabled them.\n… turns out there even are three modes:\nno snapshots at all (what I did then)\nsnapshots support enabled, with external snapshot data (the default)\nsnapshots support enabled, with internal snapshot data (the snapshots are then linked into the library itself)\nThose snapshots are created once at compile time and store the state of V8’s heap after it has fully initialized itself. Hence their benefit is that the engine doesn’t fully bootstrap over and over, … it simply restores the snapshot and is (almost) ready to start.\nOnly the second of those three modes wasn’t supported by V8Js, since it simply didn’t provide the external startup data – and hence V8 failed to start.\nDigging deeper into snapshots I found out about custom startup snapshots. V8 since version 4.3 allows extra JavaScript code to be embedded into the snapshot itself. This is you can bake React \u0026 ReactServer right into the snapshot so it doesn’t have to re-evaluate the source over and over again.\nThe performance impact of this is enormous:\nThe Y-axis shows milliseconds, the blue bar the amount of time needed by V8 to bootstrap, the red bar time needed to evaluate React \u0026 ReactServer source code. Timings are averages over 100 samples taken on my Core i5 laptop.\nI compiled V8 5.0.104 with snapshot support, hence the blue bar immediately drops from about 60 ms down to about 4 ms. Since the base snapshots doesn’t have React included, the red bare remains at ~90 ms at first.\n… including React into the snapshot, the red bar of course is gone, bootstrapping takes a little longer then – but it is many times faster than without snapshots.\n","wordCount":"381","inLanguage":"en","datePublished":"2016-02-29T00:00:00Z","dateModified":"2025-01-03T00:00:00Z","author":{"@type":"Person","name":"Stefan Siegl"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://stesie.github.io/2016/02/snapshot-performance/"},"publisher":{"@type":"Organization","name":"stesie's musings","logo":{"@type":"ImageObject","url":"https://stesie.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://stesie.github.io/ accesskey=h title="stesie's musings (Alt + H)">stesie's musings</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://stesie.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://stesie.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://stesie.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://stesie.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">20x performance boost with V8Js snapshots</h1><div class=post-meta><span title='2016-02-29 00:00:00 +0000 UTC'>February 29, 2016</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Stefan Siegl</div></header><div class=post-content><p>Recently @virgofx <a href=https://github.com/phpv8/v8js/issues/205>filed an issue</a> on V8Js whether (startup) performance of V8Js could be increased. He wants to do server-side React rendering and noticed that V8 itself needs roughly 50ms to initialize and then further 60ms to process React & ReactServer javascript code. Way too much for server side rendering (on more or less every request).</p><p>Up to V8 4.4 you simply could compile it with snapshots and V8Js made use of them. With 4.4 that stopped (V8Js just kept crashing), and I never really cared what they could do nor what the performance hit of this is, I just disabled them.</p><p>&mldr; turns out there even are three modes:</p><ul><li><p>no snapshots at all (what I did then)</p></li><li><p>snapshots support enabled, with <em>external</em> snapshot data (the default)</p></li><li><p>snapshots support enabled, with <em>internal</em> snapshot data (the snapshots are then linked into the library itself)</p></li></ul><p>Those snapshots are created once at compile time and store the state of V8&rsquo;s heap after it has fully initialized itself. Hence their benefit is that the engine doesn&rsquo;t fully bootstrap over and over, &mldr; it simply restores the snapshot and is (almost) ready to start.</p><p>Only the second of those three modes wasn&rsquo;t supported by V8Js, since it simply didn&rsquo;t provide the external startup data &ndash; and hence V8 failed to start.</p><p>Digging deeper into snapshots I found out about <a href=http://v8project.blogspot.de/2015/09/custom-startup-snapshots.html>custom startup snapshots</a>. V8 since version 4.3 allows extra JavaScript code to be embedded into the snapshot itself. This is you can bake React & ReactServer right into the snapshot so it doesn&rsquo;t have to re-evaluate the source over and over again.</p><p>The performance impact of this is enormous:</p><p><img loading=lazy src=/assets/snapshot-speed.png alt="performance comparison"></p><p>The Y-axis shows milliseconds, the blue bar the amount of time needed by V8 to bootstrap, the red bar time needed to evaluate React & ReactServer source code. Timings are averages over 100 samples taken on my Core i5 laptop.</p><p>I compiled V8 5.0.104 with snapshot support, hence the blue bar immediately drops from about 60 ms down to about 4 ms. Since the base snapshots doesn&rsquo;t have React included, the red bare remains at ~90 ms at first.</p><p>&mldr; including React into the snapshot, the red bar of course is gone, bootstrapping takes a little longer then &ndash; but it is many times faster than without snapshots.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://stesie.github.io/tags/v8js/>V8Js</a></li><li><a href=https://stesie.github.io/tags/v8-heap-snapshots/>V8 Heap Snapshots</a></li><li><a href=https://stesie.github.io/tags/performance/>Performance</a></li></ul></footer></article></main><footer class=footer><span>© 2025 Stefan Siegl · all content is <a href=https://creativecommons.org/licenses/by-sa/4.0/deed>CC-BY-SA</a></span> ·
<a href=/imprint>Imprint</a> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>