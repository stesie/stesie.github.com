<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>V8Js | ~stesie's musings</title>
<meta name=keywords content><meta name=description content><meta name=author content><link rel=canonical href=https://stefansiegl.de/categories/v8js/><link crossorigin=anonymous href=/assets/css/stylesheet.eaf1c0e3f8327b0eecb58a6cafac5ca1bc09ab794ba654be960d9aa6b1cdd1c7.css integrity="sha256-6vHA4/gyew7stYpsr6xcobwJq3lLplS+lg2aprHN0cc=" rel="preload stylesheet" as=style><link rel=icon href=https://stefansiegl.de/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://stefansiegl.de/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://stefansiegl.de/favicon-32x32.png><link rel=apple-touch-icon href=https://stefansiegl.de/apple-touch-icon.png><link rel=mask-icon href=https://stefansiegl.de/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://stefansiegl.de/categories/v8js/feed.xml><link rel=alternate hreflang=en href=https://stefansiegl.de/categories/v8js/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="V8Js"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://stefansiegl.de/categories/v8js/"><meta name=twitter:card content="summary"><meta name=twitter:title content="V8Js"><meta name=twitter:description content></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://stefansiegl.de/ accesskey=h title="~stesie's musings (Alt + H)">~stesie's musings</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://stefansiegl.de/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://stefansiegl.de/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://stefansiegl.de/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://stefansiegl.de/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><h1>V8Js</h1></header><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Heroku custom platform repo for V8Js</h2></header><div class=entry-content><p>Yesterday @dzuelke poked me to migrate the old PHP buildpack adjusted for V8Js to the new custom platform repo infrastructure. The advantage is that the custom platform repo only contains the v8js extension packages now, the rest (i.e. Apache and PHP itself) are pulled from the lang-php bucket, aka normal php buildpack.
As I already had that on my TODO list, I just immediately did that :-)
… so here’s the new heroku-v8js Github repository that has all the build formulas....</p></div><footer class=entry-footer>Planted:&nbsp;<span title='2016-03-28 00:00:00 +0000 UTC'>Mar 28, 2016</span>&nbsp;·&nbsp;1 min</footer><a class=entry-link aria-label="post link to Heroku custom platform repo for V8Js" href=https://stefansiegl.de/2016/03/heroku-custom-platform-repo/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>V8Js improved fluent setter performance</h2></header><div class=entry-content><p>After fixing V8Js’ behaviour of not retaining the object identity of passed back V8Object instances (i.e. always re-wrapping them, instead of re-using the already existing object) I tried how V8Js handles fluent setters (those that return $this at the end).
Unfortunately they weren’t handled well, that is V8Js always wrapped the same object again and again (in both directions). Functionality-wise that doesn’t make a big difference since the underlying object is the same, hence further setters can still be called....</p></div><footer class=entry-footer>Planted:&nbsp;<span title='2016-03-25 00:00:00 +0000 UTC'>Mar 25, 2016</span>&nbsp;·&nbsp;1 min</footer><a class=entry-link aria-label="post link to V8Js improved fluent setter performance" href=https://stefansiegl.de/2016/03/fluent-setters/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>V8PromiseFactory</h2></header><div class=entry-content><p>V8 has support for ES6 Promises and they make a clean JS-side API. So why not create promises from PHP, (later on) being resolved by PHP?
V8Js doesn’t allow direct creation of JS objects from PHP-code, a little JS-side helper needs to be used. One possibility is this:
class V8PromiseFactory { private $v8; public function __construct(V8Js $v8) { $this->v8 = $v8; } public function __invoke($executor) { $trampoline = $this->v8->executeString( '(function(executor) { return new Promise(executor); })'); return $trampoline($executor); } } … it can be used to construct an API method that returns a Promise like this:...</p></div><footer class=entry-footer>Planted:&nbsp;<span title='2016-03-25 00:00:00 +0000 UTC'>Mar 25, 2016</span>&nbsp;·&nbsp;2 min</footer><a class=entry-link aria-label="post link to V8PromiseFactory" href=https://stefansiegl.de/2016/03/v8promisefactory/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>funny Math.random behaviour</h2></header><div class=entry-content><p>Playing around with V8’s custom startup snapshots I noticed some funny behaviour regarding Math.random.
It is clear that if you call Math.random() within the custom startup code the generated random numbers are baked into the snapshot and then not so random anymore. If you call Math.random() at runtime, without custom startup code, it just behaves as expected: it generates random numbers. However if you have custom startup code, calling Math.random() early on startup, it correctly generates random numbers during startup but it breaks runtime random number generation causing weird error messages like...</p></div><footer class=entry-footer>Planted:&nbsp;<span title='2016-03-05 00:00:00 +0000 UTC'>Mar 5, 2016</span>&nbsp;·&nbsp;1 min</footer><a class=entry-link aria-label="post link to funny Math.random behaviour" href=https://stefansiegl.de/2016/03/math-random-fun/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>20x performance boost with V8Js snapshots</h2></header><div class=entry-content><p>Recently @virgofx filed an issue on V8Js whether (startup) performance of V8Js could be increased. He wants to do server-side React rendering and noticed that V8 itself needs roughly 50ms to initialize and then further 60ms to process React & ReactServer javascript code. Way too much for server side rendering (on more or less every request).
Up to V8 4.4 you simply could compile it with snapshots and V8Js made use of them....</p></div><footer class=entry-footer>Planted:&nbsp;<span title='2016-02-29 00:00:00 +0000 UTC'>Feb 29, 2016</span>&nbsp;·&nbsp;2 min</footer><a class=entry-link aria-label="post link to 20x performance boost with V8Js snapshots" href=https://stefansiegl.de/2016/02/snapshot-performance/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>V8Js approaching PHP7</h2></header><div class=entry-content><p>For some weeks now I had the idea that V8Js must be running on PHP7 the day it is officially published. So when I started out porting soon after they published he first release candidate (aka 7.0.0RC1) I felt some pressure, especially after noticing that it really will be a lot of work to do.
The more glad I am to announce today, that V8Js finally compiles fine and passes the whole test suite from the master branch (apart from tiny modifications that became necessary due to PHP 5....</p></div><footer class=entry-footer>Planted:&nbsp;<span title='2015-10-05 00:00:00 +0000 UTC'>Oct 5, 2015</span>&nbsp;·&nbsp;1 min</footer><a class=entry-link aria-label="post link to V8Js approaching PHP7" href=https://stefansiegl.de/2015/10/v8js-on-php7/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Two more V8Js releases</h2></header><div class=entry-content><p>Today as well as last Thursday I uploaded two more V8Js releases to PECL, both fixing issues around v8::FunctionTemplate usage that bit me at work.
Those v8::FunctionTemplate objects are used to construct constructor functions (and thus object templates) in V8. The problem with them? They are not object to garbage collection. So if we export a object with a method attached to it from PHP to JS, V8Js at first exports the object (and caches the v8::FunctionTemplate used to construct it; re-using it on subsequent export of the same class)....</p></div><footer class=entry-footer>Planted:&nbsp;<span title='2015-09-01 00:00:00 +0000 UTC'>Sep 1, 2015</span>&nbsp;·&nbsp;1 min</footer><a class=entry-link aria-label="post link to Two more V8Js releases" href=https://stefansiegl.de/2015/09/two-more-releases/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Poor V8Function call performance</h2></header><div class=entry-content><p>Today I noticed, that invocations of V8Function objects have a really poor call performance. A simple example might be:
$v8 = new V8Js(); $func = $v8->executeString('(function() { print("Hello\\n"); });'); for($i = 0; $i &lt; 1000; $i ++) { $func(); } … on my laptop this takes 2.466 seconds (with latest V8Js 0.2.1); older versions like V8Js 0.1.5 even take 80 seconds.
That felt strange, since V8Js performance generally is pretty good and the slightly changed version...</p></div><footer class=entry-footer>Planted:&nbsp;<span title='2015-08-26 00:00:00 +0000 UTC'>Aug 26, 2015</span>&nbsp;·&nbsp;1 min</footer><a class=entry-link aria-label="post link to Poor V8Function call performance" href=https://stefansiegl.de/2015/08/poor-v8js-function-call-performance/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>php.net account approved</h2></header><div class=entry-content><p>After waiting for a really long time (half a year) I finally have an approved php.net + PECL account granted with lead-rights on V8Js :-)
… therefore I finally published V8Js version 0.2.0, succeeding 0.1.5 which was published 1.5 years ago.
Changes include
adapt to latest v8 API (v8 versions from 3.24.6 up to latest 4.3 branch supported now)
v8 debugging support
apply time & memory limits to V8Function calls...</p></div><footer class=entry-footer>Planted:&nbsp;<span title='2015-03-13 00:00:00 +0000 UTC'>Mar 13, 2015</span>&nbsp;·&nbsp;1 min</footer><a class=entry-link aria-label="post link to php.net account approved" href=https://stefansiegl.de/2015/03/php-account-approved/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>V8Js Patches merged</h2></header><div class=entry-content><p>Today the last pull request in a series of contributions to the V8Js PHP extension has been merged. Good time to loose some words on the project and why I like it, so here we go :-)
V8Js is a PHP extension that integrates Google’s V8 JavaScript engine into PHP. This is the extension allows you to execute JavaScript code securely sandboxed from PHP. Besides it allows for simple exchange of data from PHP to JavaScript and back....</p></div><footer class=entry-footer>Planted:&nbsp;<span title='2013-07-17 00:00:00 +0000 UTC'>Jul 17, 2013</span>&nbsp;·&nbsp;3 min</footer><a class=entry-link aria-label="post link to V8Js Patches merged" href=https://stefansiegl.de/2013/07/v8js-patches-merged/></a></article></main><footer class=footer><span>© 2025 Stefan Siegl · all content is <a href=https://creativecommons.org/licenses/by-sa/4.0/deed>CC-BY-SA</a> · <a href=https://www.swyx.io/digital-garden-tos#for-visitors>Terms of Service</a></span> ·
<a href=/imprint>Imprint</a> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>